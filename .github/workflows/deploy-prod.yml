on:
  push:
    branches:
      - master
name: Deploy to production
jobs:
  FTP-Deploy-Action:
    name: SFTP Upload
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        fetch-depth: 3
    - uses: chrnorm/deployment-action@releases/v1
      name: Create GitHub deployment
      id: deployment
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        target_url: https://jelleglebbeek.com
        environment: production
    - name: Deploy to SFTP server
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: sftp://${{ secrets.FTP_SERVER_PROD }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        exclude: |
          **/.git*
          **/.git*/**
          .github/*
          .gitignore
          README.md
    - name: Update deployment status (success)
      if: success()
      uses: chrnorm/deployment-status@releases/v1
      with:
        token: ${{ github.token }}
        target-url: https://jelleglebbeek.com
        state: success
        deployment_id: ${{ steps.deployment.outputs.deployment_id }}
    - name: Update deployment status (failure)
      if: failure()
      uses: chrnorm/deployment-status@releases/v1
      with:
        token: ${{ github.token }}
        target-url: https://jelleglebbeek.com
        state: failure
        deployment_id: ${{ steps.deployment.outputs.deployment_id }}
